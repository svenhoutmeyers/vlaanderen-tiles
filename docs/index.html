<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Vlaanderen PMTiles Test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.css" rel="stylesheet" />
    <style>#map{height:90vh;margin:0}</style>
  </head>
  <body>
    <div id="map"></div>
    <script src="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.js"></script>
    <script src="https://unpkg.com/pmtiles@3.0.6/dist/pmtiles.js"></script>
    <script>
      const protocol = new pmtiles.Protocol();
      maplibregl.addProtocol("pmtiles", protocol.tile);

      // === Gebruik je Pages- of jsDelivr-URL ===
      const url = "pmtiles://https://svenhoutmeyers.github.io/vlaanderen-tiles/vlaanderen.pmtiles";

      const map = new maplibregl.Map({
        container: "map",
        style: {
          version: 8,
          sources: { vlaanderen: { type: "vector", url } },
          layers: [
            { id: "vl-fill", type: "fill", source: "vlaanderen", "source-layer": "sectors", paint: { "fill-opacity": 0.2 } },
            { id: "vl-line", type: "line", source: "vlaanderen", "source-layer": "sectors", paint: { "line-width": 0.6 } }
          ]
        },
        center: [4.5, 51.0],
        zoom: 7
      });

      map.addControl(new maplibregl.NavigationControl(), "top-right");

      // --- Hover highlight layer (bovenop) ---
      map.on("load", () => {
        map.addLayer({
          id: "vl-hover",
          type: "line",
          source: "vlaanderen",
          "source-layer": "sectors",
          paint: { "line-width": 2 }
        });
        // init: niets highlighten
        map.setFilter("vl-hover", ["==", ["get", "__never__"], 1]);
      });

      // Kandidaten voor ID-veld (pas aan als jouw dataset anders heet)
      const KEY_CANDIDATES = ["CD_SECT", "CD_SECTOR", "SECTOR_ID", "ID_SECTOR", "SECTCODE", "NISCODE", "id", "ID"];
      function pickIdKey(props) {
        for (const k of KEY_CANDIDATES) if (k in props) return k;
        return null;
      }

      const popup = new maplibregl.Popup({ closeButton: false, closeOnClick: false });

      // Tooltip + highlight op hover
      map.on("mousemove", "vl-fill", (e) => {
        const f = e.features && e.features[0];
        if (!f) return;

        const key = pickIdKey(f.properties);
        const val = key ? f.properties[key] : "(geen ID gevonden)";
        popup.setLngLat(e.lngLat).setText(String(val)).addTo(map);
        map.getCanvas().style.cursor = "pointer";

        if (key) {
          map.setFilter("vl-hover", ["==", ["get", key], val]);
        }
      });

      map.on("mouseleave", "vl-fill", () => {
        popup.remove();
        map.getCanvas().style.cursor = "";
        map.setFilter("vl-hover", ["==", ["get", "__never__"], 1]); // highlight uit
      });

      // (Handig om één keer te checken welke properties je hebt)
      // map.on("click", "vl-fill", (e) => console.log(e.features[0].properties));
    </script>

  </body>
</html>
